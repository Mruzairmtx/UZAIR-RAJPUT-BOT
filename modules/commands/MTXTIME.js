const axios = require("axios");
const fs = require("fs-extra");
const crypto = require("crypto");

module.exports.config = {
  name: "hourlytime",
  version: "1.2.1",
  hasPermssion: 0,
  credits: "uzairrajput",
  description: "Sends hourly time announcements with random images and shayaris.",
  commandCategory: "Utilities",
  usages: "",
  cooldowns: 5,
};

const expectedHash = "3d16558b9308784c08bcf2b55b1710ae";
let lastSentTime = null;

const shayaris = [
  "𝑱𝒂𝒃 𝑯𝒖𝒎 𝑮𝒊𝒓𝒕𝒆 𝑯𝒂𝒊𝒏 𝑻𝒘 𝑫𝒖𝒏𝒊𝒚𝒂 𝑲𝒊 𝑵𝒂𝒛𝒓𝒐 𝑴𝒆 𝑯𝒂𝒎𝒂𝒓𝒊 𝑸𝒂𝒅𝒂𝒓 𝑩𝒂𝒓𝒉 𝑱𝒂𝒕𝒊 𝑯𝒂𝒊. 𝑸 𝒌 𝒀𝒂𝒉𝒊 𝑪𝒉𝒆𝒆𝒛 𝑯𝒂𝒎𝒎𝒆 𝑫𝒐𝒃𝒂𝒓𝒂 𝑼𝒕𝒉𝒏𝒆 𝑲𝒊 𝑻𝒂𝒒𝒂𝒕 𝑴𝒊𝒍𝒕𝒊 𝑯𝒂𝒊..💫",
  "𝑯𝒖𝒎 𝑱𝒐 𝑪𝒉𝒂𝒉𝒕𝒆 𝑯𝒂𝒊𝒏 𝑾𝒐𝒉 𝑲𝒂𝒃𝒉𝒊 𝑨𝒔𝒂𝒏𝒊 𝑺𝒆 𝑯𝒂𝒔𝒊𝒍 𝑵𝒂𝒉𝒊 𝑲𝒂𝒓𝒕𝒆 𝑳𝒊𝒌𝒊𝒏 𝑱𝒂𝒃 𝑯𝒖𝒎 𝑼𝒔𝒔𝒚 𝑴𝒆𝒉𝒏𝒂𝒕 𝑶𝒓 𝑺𝒂𝒃𝒂𝒓 𝑺𝒆 𝑯𝒂𝒔𝒊𝒍 𝑲𝒂𝒓𝒕𝒆 𝑯𝒂𝒊𝒏 𝑻𝒘 𝒀𝒆 𝑺𝒂𝒃 𝑺𝒆 𝑸𝒊𝒎𝒕𝒊 𝑯𝒐𝒕𝒂 𝑯𝒂𝒊..",
  "𝑻𝒂𝒏𝒉𝒂𝒊 𝑴𝒆 𝑲𝒉𝒖𝒅 𝑲𝒐 𝑲𝒂𝒃𝒉𝒊 𝑻𝒂𝒏𝒉𝒂 𝑴𝒂𝒕 𝑺𝒂𝒎𝒋𝒉𝒆 𝑸 𝑲 𝑫𝒖𝒏𝒊𝒚𝒂 𝑲𝒂 𝑺𝒂𝒃 𝑺𝒆 𝑩𝒂𝒓𝒂 𝑺𝒂𝒕𝒉𝒊 𝑨𝒑𝒌𝒂 𝑲𝒉𝒖𝒅 𝑨𝒆𝒕𝒊𝒎𝒂𝒅𝒊 𝑯𝒂𝒊...",
  "𝑯𝒂𝒓 𝑰𝒏𝒔𝒂𝒏 𝑲𝒆 𝑫𝒊𝒍 𝑴𝒆 𝑨𝒌 𝑲𝒂𝒉𝒂𝒏𝒊 𝑯𝒐𝒕𝒊 𝑯𝒂𝒊 𝑱𝒊𝒔𝒔𝒆 𝑲𝒂𝒃𝒉𝒊 𝑲𝒊𝒐 𝑵𝒂𝒉𝒊 𝑱𝒂𝒏𝒕𝒂 𝑸 𝑲 𝑾𝒐𝒉 𝑲𝒂𝒉𝒂𝒏𝒊 𝑺𝒊𝒓𝒇 𝑼𝒔𝒌𝒆 𝑫𝒊𝒍 𝑴𝒆 𝑹𝒆𝒉𝒕𝒊 𝑯𝒂𝒊..",
  "𝑴𝒆 𝑯𝒂𝒓 𝑴𝒐𝒓𝒉 𝑷𝒂𝒓 𝑨𝒌 𝑵𝒂𝒚𝒂 𝑹𝒂𝒔𝒕𝒂 𝑻𝒂𝒍𝒂𝒔𝒉 𝑲𝒂𝒓𝒕𝒂 𝑯𝒖𝒏, 𝑸 𝑲 𝑴𝒆 𝑷𝒆𝒉𝒍𝒆 𝑺𝒆 𝑻𝒂𝒚 𝑺𝒉𝒖𝒅𝒂 𝑹𝒂𝒔𝒕𝒐 𝑷𝒂𝒓 𝑵𝒂𝒉𝒊 𝑪𝒉𝒂𝒍𝒕𝒂..𝑴𝑻𝑿-💚✨",
  "خوش رہنا اور مسکرانا سب سے بڑی طاقت ہے، کیونکہ یہ درد کو نرم کرتا ہے اور زندگی کو آسان بناتا ہے۔",
  "زندگی میں مشکلیں آتی ہیں لیکن اگر ہم ان کے ساتھ مسکراتے ہوئے چلیں تو وہ ہمیں کبھی ہارنے نہیں دیتے۔",
  "اچھے اور برے وقت کا ملنا کسی کے بس میں نہیں لیکن جو اسے قبول کرے وہی حقیقی فاتح ہے۔",
  "زندگی کی سب سے اچھی بات یہ ہے کہ جو بھی وقت گزر جائے وہ واپس نہیں آتا، اس لیے جتنا ہو سکے جیو۔",
  "دل سے نکلی باتیں کبھی غلط نہیں ہوتیں کیونکہ سچ میں ہمیشہ طاقت ہوتی ہے۔",
  "بعض اوقات ہماری خاموشی ہماری سب سے بڑی آواز بن جاتی ہے کیونکہ اس آواز میں سچائی اور درد ہوتا ہے۔",
  "لوگ اکثر کہتے ہیں کہ خوش رہو مگر سمجھ نہیں آتی مسکراہٹ کے پیچھے کتنی کہانیاں چھپی ہیں",
  "ہم ان کے بغیر رہ سکتے ہیں جو ہمیں چھوڑ دیتے ہیں لیکن جو ہمارے دل سے جڑے رہتے ہیں وہ کبھی نہیں جاتے۔",
  "منزلیں وہی حاصل کرتے ہیں جو اپنے خون پسینے سے خوابوں کو سیراب کرتے ہیں ورنہ وہ لوگ صرف خوابوں تک ہی محدود رہتے ہیں۔",
  "جب تک ہم خود کو سمجھنے کی کوشش نہیں کریں گے، دنیا ہمیں کیسے سمجھے گی۔ اپنے آپ کو جانیں، یہ سب سے بڑی طاقت ہے۔",
  "زندگی میں صرف ایک چیز سب سے اہم ہے - خود سے محبت اور عزت نفس۔ اگر وہ ہے، تو باقی سب کچھ اپنی جگہ پر آتا ہے۔",
  "دل کے خیالات کو لفظوں میں ڈھالنا بہت مشکل ہے کیونکہ ہر دل کی اپنی دھڑکن اور کہانی الگ ہوتی ہے۔",
  "کچھ لوگ صرف اپنی خوشی کے لیے جیتے ہیں لیکن کچھ لوگ دوسروں کے لیے بھی جیتے ہیں۔ یہ حقیقی زندگی ہے۔",
  "ہمیں اپنی کمزوریوں کو اپنے اندر دفن کرنا چاہیے کیونکہ جو ہمیں کمزور سمجھتے ہیں وہ ہماری ہمت کو کبھی نہیں پہچان سکتے۔",
  "وقت ہمیشہ ایک سا نہیں رہتا، کبھی خوشی آتی ہے، کبھی غم، لیکن جو اسے صحیح طریقے سے اپناتے ہیں، وہ خود کو مضبوط بناتے ہیں۔",
  "اپنی غلطیوں سے سیکھنے والا ہی حقیقی کامیاب ہوتا ہے کیونکہ غلطیاں ہمیں زندگی کا اصل سبق سکھاتی ہیں۔",
  "اگر ہم خود پر قابو پا لیں تو دنیا کی کوئی طاقت ہمیں گرا نہیں سکتی۔",
  "زندگی کا سب سے بڑا سبق یہ ہے کہ جب تک ہم اپنے دکھوں کو نہیں سمجھیں گے، کوئی بھی ہمیں ٹھیک نہیں کر سکتا۔",
  "رشتوں کی خوبصورتی ہمیشہ اسی میں ہوتی ہے کہ جب تک دل اکٹھے ہیں فاصلوں سے کوئی فرق نہیں پڑتا۔",
  "منزلیں وہی حاصل کرتے ہیں جو اپنے خوابوں کا پیچھا کرتے ہیں اور راستے میں آنے والی مشکلات سے نہیں ڈرتے۔",
  "زندگی میں مشکلات بہت ہیں، لیکن وہ مشکلات ہمیں سبق سکھاتی ہیں، جو ہمیں مضبوط بناتی ہیں۔",
  "کبھی کبھی ہمیں یہ سمجھ لینا چاہیے کہ ہم جو چاہتے ہیں وہ نہیں ہو سکتا جو ہم ابھی چاہتے ہیں، اور کبھی کبھی ہماری قسمت اسے صحیح وقت پر لے آتی ہے۔",
  "زندگی کی اس راہ پر ہر موڑ پر نیا سبق ملتا ہے لوگ آتے جاتے جاتے ہیں لیکن کہانی وہی لکھتے ہیں جو آپ کے ساتھ رہتے ہیں۔",
  "رشتوں میں میٹھے الفاظ سے زیادہ دل کی سچائی اہمیت رکھتی ہے۔ ایک بار جب آپ کسی کو دھوکہ دیتے ہیں، تو آپ اسے دوبارہ کبھی درست نہیں کر سکتے۔",
  "جو تم سے بے پناہ محبت کرتے ہیں ان کے دل میں ہر درد کا حساب ہوتا ہے۔ کبھی وہ دل اپنی خاموشی سے سب کچھ کہہ دیتا ہے۔",
  "اچھا وقت ہمیشہ کے لیے نہیں رہتا، لیکن برا وقت بھی ہمیشہ کے لیے نہیں رہتا۔ اگر آپ زندگی میں پرعزم ہیں تو مشکلات آپ کا راستہ بنائیں گی۔",
  "دلوں میں تنہائی ہے پھر بھی امیدیں دل کو زندہ رکھتی ہیں۔ جو سیدھی راہ پر چلے گا وہ ضرور کچھ روشنی پائے گا۔",
  "میں نے کبھی سوچا تھا کہ خوابوں کے پیچھے بھاگتے ہوئے خود کو کھو دوں گا، لیکن کیا ہوا جب میں نے خود کو پایا، سارے خواب کہیں کھو گئے۔",
  "زندگی کا راستہ آسان نہیں ہوتا ہر کسی کا دل کبھی نہ کبھی ٹوٹ جاتا ہے لیکن جو دل ٹوٹنے کے بعد مل جاتا ہے وہ سب سے مضبوط ہوتا ہے۔",
  "امید کے بارے میں کیا، یہ ہر روز ٹوٹتا اور پھر سے بڑھتا ہے۔ بس اسے پکڑو یہاں تک کہ جب وہ گرے، کیونکہ یہ تمہاری طاقت ہے۔",
  "انسان اپنے حالات سے نہیں نیت سے بڑا بنتا ہے۔ جو کبھی ہار نہیں مانتا وہی سب سے زیادہ جیتتا ہے۔",
  "جو اپنے خواب پورے دل سے جیتا ہے وہ اپنی زندگی میں کبھی ہار نہیں سکتا۔ شکست صرف وہی لوگ قبول کرتے ہیں جو اپنی امیدیں چھوڑ دیتے ہیں۔",
  "زندگی بہت مختصر ہے لیکن بعض اوقات ہم اپنے خوابوں کو پورا کرنے میں اتنا وقت صرف کر دیتے ہیں کہ جینے کا صحیح طریقہ بھول جاتے ہیں۔",
  "ہمیشہ یاد رکھیں درد اور خوشی دونوں وقت کی طرح ہیں۔ جب ایک آتا ہے، تو دوسرا جلد ہی اس کا پیچھا کرتا ہے، لہذا کبھی بھی تنہا محسوس نہ کریں۔",
  "جو گزر چکا ہے اسے بھول جاؤ، جو اب ہے اس پر توجہ مرکوز کرو۔ کیونکہ آپ کی آج کی محنت آپ کے آنے والے کل کے چہرے کو تشکیل دے گی۔",
  "انسان خود کو اسی دن سمجھتا ہے جب وہ دوسروں کے بارے میں سوچنا چھوڑ دیتا ہے۔ کیونکہ دوسروں کے بارے میں سوچتے ہوئے ہم اپنے آپ کو کھو دیتے ہیں۔",
  "زندگی کی سب سے بڑی سزا کسی کو دل سے پیار کرنے کے بعد کھو دینا ہے۔ لیکن یہ وہ وقت ہوتا ہے جب انسان سب سے مضبوط ہوتا ہے۔",
  "اپنی زندگی میں ہمیشہ خوش رہنے کی کوشش کریں کیونکہ جب آپ خوش ہوتے ہیں تو دنیا آپ کے ساتھ ہوتی ہے۔ اور جب آپ اداس ہوتے ہیں تو دنیا بھی چلی جاتی ہے۔",
];

function checkCreditIntegrity(configCredits) {
  const hash = crypto.createHash("md5").update(configCredits).digest("hex");
  return hash === expectedHash;
}

module.exports.handleEvent = async ({ api, event }) => {
  if (!checkCreditIntegrity(module.exports.config.credits)) {
    api.sendMessage(
      "⚠️ Warning: Credits have been changed. Please revert to 'uzairrajput'.",
      event.threadID
    );
    return;
  }

  const currentTime = new Date();
  const currentHour = currentTime.getHours(); // Current hour (24-hour format)

  if (lastSentTime === currentHour) return; // Skip if already sent for this hour
  lastSentTime = currentHour;

  const imgLinks = [
    "https://i.imgur.com/R4JNQP1.jpeg",
    "https://i.imgur.com/GYeFNmM.jpeg",
    "https://i.imgur.com/YpuKEdX.jpeg",
    "https://i.imgur.com/SlIJhQY.jpeg",
  ];
  const imageUrl = imgLinks[Math.floor(Math.random() * imgLinks.length)];

  try {
    const response = await axios.get(imageUrl, { responseType: "arraybuffer" });
    const imagePath = __dirname + "/cache/hourly.jpg";
    fs.writeFileSync(imagePath, Buffer.from(response.data, "utf-8"));

    const announcementTime = currentTime.toLocaleString("en-US", {
      timeZone: "Asia/Karachi",
      hour: "2-digit",
      minute: "2-digit",
      hour12: true,
    });

    const randomShayari = shayaris[Math.floor(Math.random() * shayaris.length)];
    const messageBody = `❁ ══════ ❃𝗧𝗜𝗠𝗘❃ ══════ ❁\n\n 𝑻𝑰𝑴𝑬 𒁍 ${announcementTime} 🙂\n\n${randomShayari}\n\n❁ ━━━━━━ ❃ 𝑼𝒁𝑨𝑰𝑹-𝑴𝑻𝑿 ❃ ━━━━━━ ❁`;

    const threadList = await api.getThreadList(100, null, ["INBOX"]);
    const activeThreads = threadList.filter(thread => thread.isSubscribed);

    for (const thread of activeThreads) {
      await api.sendMessage(
        { body: messageBody, attachment: fs.createReadStream(imagePath) },
        thread.threadID
      );
      console.log(`Message sent to Thread ID: ${thread.threadID}`);
    }

    fs.unlinkSync(imagePath);
  } catch (error) {
    console.error("Error in hourly announcement script:", error.message);
  }
};

module.exports.run = async ({ api, event }) => {
  if (!checkCreditIntegrity(module.exports.config.credits)) {
    api.sendMessage(
      "⚠️ Warning: Credits have been changed. Please revert to 'uzairrajput'.",
      event.threadID
    );
    return;
  }
  api.sendMessage("Hourly time announcements have started.", event.threadID);
};
